<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Smart Traffic Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1e88e5;
            --primary-dark: #1565c0;
            --background: #121212;
            --surface: #1e1e1e;
            --surface-hover: #2c2c2c;
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
        }
        
        * {
            box-sizing: border-box;
            transition: all 0.2s ease;
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        .sidebar {
            width: 250px;
            background-color: var(--surface);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 10;
        }
        
        .logo {
            text-align: center;
            padding: 10px 20px 30px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .logo i {
            font-size: 34px;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .sidebar a {
            color: var(--text);
            text-decoration: none;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            border-radius: 0;
            margin: 2px 0;
            font-weight: 500;
        }
        
        .sidebar a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .sidebar a:hover {
            background-color: var(--surface-hover);
            color: var(--primary);
        }
        
        .sidebar a.active {
            background-color: var(--primary);
            color: white;
        }
        
        .sidebar a.active:hover {
            background-color: var(--primary-dark);
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background-color: var(--surface);
            padding: 15px 30px;
            font-size: 22px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .header-title {
            display: flex;
            align-items: center;
        }
        
        .header-title i {
            color: var(--primary);
            margin-right: 10px;
            font-size: 24px;
        }
        
        .profile {
            display: flex;
            align-items: center;
        }
        
        .profile-img {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-size: 18px;
        }
        
        .profile a {
            color: var(--text);
            text-decoration: none;
            margin-left: 15px;
            display: flex;
            align-items: center;
            font-size: 14px;
            font-weight: 500;
        }
        
        .profile a i {
            margin-right: 5px;
        }
        
        .profile a:hover {
            color: var(--primary);
        }
        
        .content-container {
            flex: 1;
            padding: 20px 30px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .welcome-message {
            text-align: center;
            padding: 50px 0;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .welcome-message h2 {
            color: var(--text);
            margin-bottom: 15px;
        }
        
        .welcome-message i {
            font-size: 50px;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .section {
            display: none;
            background-color: var(--surface);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
            margin: 0 auto;
            border: 1px solid rgba(255,255,255,0.07);
            max-width: 900px;
            width: 100%;
            height: auto;
            min-height: 500px;
        }
        
        .section h3 {
            margin-top: 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 15px;
            margin-bottom: 25px;
            font-size: 24px;
            color: var(--primary);
            text-align: center;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 160px;
        }
        
        button i {
            margin-right: 8px;
        }
        
        button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .button-secondary {
            background-color: var(--surface-hover);
        }
        
        .button-secondary:hover {
            background-color: #3a3a3a;
        }
        
        .form-group {
            margin: 20px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .form-group input, .form-group button {
            padding: 14px 15px;
            width: 100%;
            background-color: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 5px;
            color: var(--text);
            font-size: 15px;
        }
        
        .form-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(30,136,229,0.2);
        }
        
        .form-group input[type="file"] {
            padding: 12px;
        }
        
        /* Enhanced table styling */
        table {
            width: 90%;
            margin: 30px auto;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            background-color: var(--surface);
        }
        
        thead {
            background: linear-gradient(45deg, var(--primary-dark), var(--primary));
        }
        
        th {
            padding: 16px;
            text-align: center;
            font-weight: 600;
            color: white;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            font-size: 14px;
        }
        
        td {
            padding: 14px 16px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            vertical-align: middle;
        }
        
        tbody tr:last-child td {
            border-bottom: none;
        }
        
        tbody tr {
            transition: all 0.3s ease;
        }
        
        tbody tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.03);
        }
        
        tbody tr:hover {
            background-color: rgba(30, 136, 229, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }
        
        /* Action buttons in table */
        .action-cell {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .action-button {
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
        }
        
        .action-button i {
            margin-right: 5px;
        }
        
        .download-button {
            background-color: rgba(30, 136, 229, 0.15);
            color: var(--primary);
        }
        
        .download-button:hover {
            background-color: rgba(30, 136, 229, 0.3);
        }
        
        .delete-button {
            background-color: rgba(244, 67, 54, 0.15);
            color: var(--danger);
        }
        
        .delete-button:hover {
            background-color: rgba(244, 67, 54, 0.3);
        }
        
        .empty-table-message {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .section-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 10px;
            margin: 20px 0;
            padding: 30px;
            text-align: center;
        }
        
        .section-content i {
            font-size: 60px;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .section-content h4 {
            color: var(--text);
            margin-bottom: 15px;
            font-size: 22px;
        }
        
        .section-content p {
            color: var(--text-secondary);
            max-width: 500px;
        }
        
        .active {
            display: block;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--success);
            color: white;
            border-radius: 5px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
        }
        
        .notification i {
            margin-right: 10px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s linear 0.2s, opacity 0.2s;
        }
        
        .loading-overlay.active {
            visibility: visible;
            opacity: 1;
            transition-delay: 0s;
        }
        
        .loader {
            border: 5px solid rgba(255,255,255,0.1);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .link-button {
            color: var(--primary);
            text-decoration: underline;
            cursor: pointer;
            font-weight: 500;
        }
        
        .link-button:hover {
            color: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-traffic-light"></i>
            <div class="logo-text">SMART TRAFFIC</div>
        </div>
        <a href="#red-light" onclick="showSection('red-light')" class="active">
            <i class="fas fa-lightbulb"></i> Red Light Violation
        </a>
        <a href="#wrong-way" onclick="showSection('wrong-way')">
            <i class="fas fa-ban"></i> Wrong Way Driving
        </a>
        <a href="#no-helmet" onclick="showSection('no-helmet')">
            <i class="fas fa-hard-hat"></i> No Helmet Detection
        </a>
        <a href="#license-plate" onclick="showSection('license-plate')">
            <i class="fas fa-id-card"></i> License Plate Detection
        </a>
        <a href="#recorded-data" onclick="showSection('recorded-data')">
            <i class="fas fa-database"></i> Recorded Data
        </a>
    </div>
    
    <div class="main-content">
        <div class="header">
            <div class="header-title">
                <i class="fas fa-traffic-light"></i>
                <span>SMART TRAFFIC MANAGEMENT SYSTEM</span>
            </div>
            <div class="profile">
                <div class="profile-img">
                    <i class="fas fa-user"></i>
                </div>
                <a href="profile.html"><i class="fas fa-user-circle"></i> Profile</a> |
                <a href="login.html" id="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>
        
        <div class="content-container">
            <div id="welcome-screen" class="section welcome-message">
                <i class="fas fa-traffic-light"></i>
                <h2>Welcome to the Smart Traffic Management System</h2>
                <p>Select an option from the left navigation panel to begin.</p>
            </div>
            
            <div id="sections">
                <script>
                    const sections = [
                        {id: 'red-light', name: 'RED LIGHT VIOLATION', icon: 'lightbulb', description: 'This is red light violation detection. Check which cars are violating the red light.'},
                        {id: 'wrong-way', name: 'WRONG WAY DRIVING', icon: 'ban', description: 'This is wrong way driving detection. Check which vehicles are driving against the traffic flow.'},
                        {id: 'no-helmet', name: 'NO HELMET DETECTION', icon: 'hard-hat', description: 'This is no helmet detection. Check which motorcycle riders are not wearing helmets.'},
                        {id: 'license-plate', name: 'LICENSE PLATE DETECTION', icon: 'id-card', description: 'This is license plate detection. Recognize and record license plates of vehicles.'}
                    ];
                    let recordedData = [];

                    sections.forEach(section => {
                        document.write(`
                            <div id="${section.id}" class="section">
                                <h3><i class="fas fa-${section.icon}"></i> ${section.name}</h3>
                                <div class="section-content">
                                    <i class="fas fa-${section.icon}"></i>
                                    <h4>${section.name} Detection</h4>
                                    <p>${section.description}</p>
                                </div>
                                <div class="button-group">
                                    <button onclick="showSection('add-record-${section.id}')">
                                        <i class="fas fa-plus-circle"></i> Add Record
                                    </button>
                                    <a href="http://127.0.0.1:8080/"><button>
                                     <i class="fas fa-play"></i> Run Detection
                                    </button></a>

                                    
                                </div>
                            </div>
                            
                            <div id="add-record-${section.id}" class="section">
                                <h3><i class="fas fa-plus-circle"></i> Add ${section.name} Record</h3>
                                <form id="addRecordForm-${section.id}">
                                    <div class="form-group">
                                        <label>Video File Name:</label>
                                        <input type="text" id="file-${section.id}" placeholder="Enter file name" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Area Name:</label>
                                        <input type="text" id="area-${section.id}" placeholder="Enter area name" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Street Name:</label>
                                        <input type="text" id="street-${section.id}" placeholder="Enter street name" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Camera Code:</label>
                                        <input type="text" id="camera-${section.id}" placeholder="Enter camera code" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Video Date:</label>
                                        <input type="date" id="date-${section.id}" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Upload Video:</label>
                                        <input type="file" id="video-${section.id}" accept="video/*" required>
                                    </div>
                                    <div class="button-group">
                                        <button type="button" onclick="saveRecord('${section.id}')">
                                            <i class="fas fa-save"></i> Save Record
                                        </button>
                                        <button type="button" class="button-secondary" onclick="showSection('${section.id}')">
                                            <i class="fas fa-times"></i> Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        `);
                    });
                </script>
            </div>
            
            <div id="recorded-data" class="section">
                <h3><i class="fas fa-database"></i> RECORDED DATA</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Filename</th>
                            <th>Area</th>
                            <th>Street</th>
                            <th>Camera</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr>
                            <td colspan="6" class="empty-table-message">
                                No records found. <span class="link-button" onclick="showSection('add-record-red-light')">Add a new record</span>.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-message">Operation successful!</span>
    </div>
    
    <div class="loading-overlay" id="loading-overlay">
        <div class="loader"></div>
    </div>
    
    <script>
        // Function to save data to localStorage
        function saveDataToStorage() {
            localStorage.setItem('trafficViolationData', JSON.stringify(recordedData));
        }

        // Function to load data from localStorage
        function loadDataFromStorage() {
            const storedData = localStorage.getItem('trafficViolationData');
            if (storedData) {
                recordedData = JSON.parse(storedData);
            }
        }

        function showSection(id) {
            // Hide the welcome screen if showing any section
            document.getElementById('welcome-screen').style.display = 'none';
            
            // Update active sidebar link
            document.querySelectorAll('.sidebar a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + id.split('-')[0]) {
                    link.classList.add('active');
                }
            });
            
            // Show selected section
            document.querySelectorAll('.section').forEach(section => {
                if (section.id !== 'welcome-screen') {
                    section.classList.remove('active');
                }
            });
            document.getElementById(id).classList.add('active');
            
            // Update hash in URL
            window.location.hash = id;
            
            // Load recorded data if viewing that section
            if (id === 'recorded-data') displayRecordedData();
        }

        function saveRecord(type) {
            // Show loading overlay
            document.getElementById('loading-overlay').classList.add('active');
            
            // Simulate processing delay
            setTimeout(() => {
                const filename = document.getElementById(`file-${type}`).value;
                const area = document.getElementById(`area-${type}`).value;
                const street = document.getElementById(`street-${type}`).value;
                const camera = document.getElementById(`camera-${type}`).value;
                const date = document.getElementById(`date-${type}`).value;
                const video = document.getElementById(`video-${type}`).files[0];
                
                // Create an object URL for the video file
                const videoLink = video ? URL.createObjectURL(video) : '#';
                
                // Add record to stored data
                recordedData.push({ 
                    filename, 
                    area, 
                    street, 
                    camera, 
                    date: formatDate(date), 
                    videoLink,
                    type
                });
                
                // Save data to localStorage
                saveDataToStorage();
                
                // Hide loading overlay
                document.getElementById('loading-overlay').classList.remove('active');
                
                // Show success notification
                showNotification('Record saved successfully!');
                
                // Reset form
                document.getElementById(`addRecordForm-${type}`).reset();
                
                // Navigate to recorded data view
                showSection('recorded-data');
            }, 1500);
        }

        function runDetection(category) {
    fetch('/run_detection', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ category: category })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Success:', data);
        // Check if we should redirect (specifically for red-light detection)
        if (data.redirect) {
            window.location.href = data.redirect;
        }
    })
    .catch((error) => {
        console.error('Error:', error);
    });
}

        <!-- The entire previous HTML remains the same, just replace the runViolationDetection function in the script section -->

//         function runViolationDetection(type) {
//     // Show loading overlay
//     document.getElementById('loading-overlay').classList.add('active');

//     // Send an AJAX request to run_detection
//     fetch('/run_detection', {
//         method: 'POST',
//         headers: {
//             'Content-Type': 'application/x-www-form-urlencoded'
//         },
//         body: `category=${encodeURIComponent(type)}`
//     })
//     .then(response => {
//         if (response.ok) {
//             return response.text();
//         } else {
//             throw new Error('Failed to launch detection script.');
//         }
//     })
//     .then(data => {
//         // Hide loading overlay
//         document.getElementById('loading-overlay').classList.remove('active');

//         // Show success notification
//         showNotification('Detection script launched in command prompt!');
//     })
//     .catch(error => {
//         console.error('Error:', error);
//         showNotification('Error launching detection script.');
//     });
// }
// function runViolationDetection(type) {
//         // Show loading overlay
//     //     document.getElementById('loading-overlay').classList.add('active');
        
//     //     // Create a form to submit the category
//     //     const form = document.createElement('form');
//     //     form.method = 'POST';
//     //     form.action = '/run_detection';
        
//     //     const categoryInput = document.createElement('input');
//     //     categoryInput.type = 'hidden';
//     //     categoryInput.name = 'category';
//     //     categoryInput.value = type;
//     //     // Simulate processing delay
//     //     setTimeout(() => {
//     //         // Hide loading overlay
//     //         document.getElementById('loading-overlay').classList.remove('active');
            
//     //         // Show success notification
//     //         showNotification('Detection script launched in command prompt!');
            
//     //         // Submit the form to run detection
//     //         form.submit();
//     //     }, 1000);
//     fetch('/run_detection', {
//     method: 'POST',
//     headers: {
//         'Content-Type': 'application/json'
//     },
//     body: JSON.stringify({ category: type })
// })

        //  form.appendChild(categoryInput);
        //  document.body.appendChild(form);
        
        
    // }
//     function runViolationDetection(type) {
//     // Show loading overlay
//     document.getElementById('loading-overlay').classList.add('active');

//     fetch('/run_detection', {
//         method: 'POST',
//         headers: {
//             'Content-Type': 'application/json'
//         },
//         body: JSON.stringify({ category: type })
//     })
//     .then(response => {
//         if (!response.ok) {
//             throw new Error('Failed to launch detection script.');
//         }
//         return response.json(); // Parse JSON response
//     })
//     .then(data => {
//         console.log(data); // Debugging
//         // Hide loading overlay
//         document.getElementById('loading-overlay').classList.remove('active');
//         // Show success notification
//         showNotification(data.message);
//     })
//     .catch(error => {
//         console.error('Error:', error);
//         showNotification('Error launching detection script.');
//     });
// }



function runViolationDetection(category) {
    // Show loading overlay
    document.getElementById('loading-overlay').classList.add('active');

    // Fetch API call
    fetch(`http://127.0.0.1:8080/run_detection/${category}`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        }
    })
     // Show loading overlay
     document.getElementById('loading-overlay').classList.add('active');

// Fetch API call
fetch(`http://127.0.0.1:5000/run_detection/${category}`, {
    method: "POST",
    headers: {
        "Content-Type": "application/json"
    }
})
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        console.log(data);
        alert("Detection started successfully!");
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Failed to start detection.");
    })
    .finally(() => {
        // Hide loading overlay
        document.getElementById('loading-overlay').classList.remove('active');
    });
}

        function displayRecordedData() {
            const tableBody = document.getElementById('table-body');
            
            if (recordedData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="empty-table-message">No records found. <span class="link-button" onclick="showSection(\'add-record-red-light\')">Add a new record</span>.</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            recordedData.forEach((record, index) => {
                tableBody.innerHTML += `
                    <tr>
                        <td>${record.filename}</td>
                        <td>${record.area}</td>
                        <td>${record.street}</td>
                        <td>${record.camera}</td>
                        <td>${record.date}</td>
                        <td class="action-cell">
                            <span class="action-button download-button" onclick="downloadVideo('${record.videoLink}', '${record.filename}')">
                                <i class="fas fa-download"></i> Download
                            </span>
                            <span class="action-button delete-button" onclick="deleteRecord(${index})">
                                <i class="fas fa-trash"></i> Delete
                            </span>
                        </td>
                    </tr>
                `;
            });
        }

        function downloadVideo(link, filename) {
            // Create a temporary anchor element
            const a = document.createElement('a');
            a.href = link;
            a.download = filename + '.mp4';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showNotification('Downloading video: ' + filename);
        }

        function deleteRecord(index) {
            if (confirm('Are you sure you want to delete this record?')) {
                recordedData.splice(index, 1);
                // Save updated data to localStorage
                saveDataToStorage();
                displayRecordedData();
                showNotification('Record deleted successfully!');
            }
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');
            
            notificationMessage.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        // Function to handle logout
        function logoutUser() {
            // Clear the stored data on logout
            localStorage.removeItem('trafficViolationData');
            
            // Show loading overlay briefly to simulate logout process
            document.getElementById('loading-overlay').classList.add('active');
            
            // Redirect after a short delay
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 500);
        }
        
        // Ensure the logout link works correctly
        document.getElementById('logout-link').addEventListener('click', function(e) {
            e.preventDefault();
            logoutUser();
        });
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage
            loadDataFromStorage();
            
            // Check if URL has a hash and show the corresponding section
            const hash = window.location.hash.substring(1);
            if (hash && document.getElementById(hash)) {
                showSection(hash);
            } else {
                // Show first option by default
                showSection('red-light');
            }
        });
    </script>
    <script>
       // Wait for the DOM to be fully loaded
document.addEventListener('DOMContentLoaded', function() {
    // Define the port mapping for each section
    const portMapping = {
        'red-light': '8080',
        'wrong-way': '5000',
        'no-helmet': '7000', 
        'license-plate': '3000'
    };

    // Function to fix buttons in a specific section
    function fixButtonsInSection(sectionId, port) {
        const section = document.getElementById(sectionId);
        if (!section) {
            console.error(`Section with ID "${sectionId}" not found`);
            return;
        }
        
        const buttonGroup = section.querySelector('.button-group');
        if (!buttonGroup) {
            console.error(`Button group not found in section "${sectionId}"`);
            return;
        }
        
        // Remove all existing Run Detection buttons
        const anchors = buttonGroup.querySelectorAll('a');
        anchors.forEach(anchor => {
            if (anchor.textContent.includes('Run Detection')) {
                buttonGroup.removeChild(anchor);
            }
        });
        
        // Create a single new button with the correct port
        const newAnchor = document.createElement('a');
        newAnchor.href = `http://127.0.0.1:${port}/`;
        
        const newButton = document.createElement('button');
        newButton.innerHTML = '<i class="fas fa-play"></i> Run Detection';
        
        // Add the button to the anchor and the anchor to the button group
        newAnchor.appendChild(newButton);
        buttonGroup.appendChild(newAnchor);
        
        console.log(`Updated button for ${sectionId} to port ${port}`);
    }
    
    // Apply the fix to all sections with a delay to ensure sections are loaded
    setTimeout(() => {
        console.log("Applying button fixes to all sections");
        for (const [sectionId, port] of Object.entries(portMapping)) {
            console.log(`Processing section: ${sectionId} for port: ${port}`);
            fixButtonsInSection(sectionId, port);
        }
    }, 500);
});
    
    </script>
</body>
</html>